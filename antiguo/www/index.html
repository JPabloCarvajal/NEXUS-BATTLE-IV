<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>BattleRoom Demo</title>
</head>
<body>
  <h1>Simulación de BattleRooms</h1>

  <!-- Datos generales del jugador -->
  <label for="playerName">Nombre del jugador:</label>
  <input id="playerName" type="text" placeholder="Ej: Juanito"><br><br>

  <!-- Tipo de sala al crear -->
  <label for="roomType">Tipo de sala:</label>
  <select id="roomType">
    <option value="1v1">1v1</option>
    <option value="2v2">2v2</option>
    <option value="3v3">3v3</option>
  </select><br><br>

  <!-- Botón para crear sala -->
  <button id="createBtn">Crear sala</button>

  <hr>

  <!-- Unirse a sala -->
  <h2>Unirse a una sala existente</h2>
  <label for="roomIdJoin">ID de la sala:</label>
  <input id="roomIdJoin" type="text" placeholder="Ej: a1b2c3">
  <button id="joinBtn">Unirse a sala</button>

  <!-- Botón para salir de sala (oculto al inicio) -->
  <button id="leaveBtn" style="display:none; background-color:red; color:white;">Salir de sala</button>

  <h2>Mensajes de la sala</h2>
  <ul id="messages"></ul>

  <!-- Script del cliente de Socket.IO -->
  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();

    const createBtn = document.getElementById("createBtn");
    const joinBtn = document.getElementById("joinBtn");
    const leaveBtn = document.getElementById("leaveBtn");

    const playerNameInput = document.getElementById("playerName");
    const roomTypeInput = document.getElementById("roomType");
    const roomIdJoinInput = document.getElementById("roomIdJoin");
    const messages = document.getElementById("messages");

    let currentRoomId = null; // ID de la sala actual

    // Datos de héroe por defecto
    const defaultHero = {
      id: "hero1",
      heroType: "FIRE_MAGE",
      level: 1,
      experience: 0,
      health: 100,
      power: 50,
      attack: 15,
      defense: 10,
      damage: 20,
      equipment: {
        weapons: [],
        armors: [],
        items: [],
        epicAbility: {
          name: "Fuego Infernal",
          compatibleHeroType: "FIRE_MAGE",
          effects: [],
          cooldown: 2,
          isAvailable: true
        }
      },
      specialActions: [],
      state: "ALIVE"
    };

    function getPlayerData() {
      const name = playerNameInput.value.trim() || "Jugador sin nombre";
      return {
        playerId: socket.id,
        name: name,
        isLoggedIn: true,
        credits: 100,
        selectedHero: defaultHero,
        inventory: []
      };
    }

    function showLeaveButton() {
      leaveBtn.style.display = "inline-block";
    }

    function hideLeaveButton() {
      leaveBtn.style.display = "none";
    }

    createBtn.onclick = () => {
      const roomType = roomTypeInput.value;
      const player = getPlayerData();

      let maxPlayers = 2;
      if (roomType === "1v1") maxPlayers = 2; 
      else if (roomType === "2v2") maxPlayers = 4;
      else if (roomType === "3v3") maxPlayers = 6;

      socket.emit("createRoom", {
        player,
        options: {
          maxPlayers
        }
      }, (response) => {
        if (response.success) {
          currentRoomId = response.room.id;
          log(` Sala creada: ID = ${currentRoomId} (${response.room.maxPlayers} jugadores)`);
          showLeaveButton();
        } else {
          log(`❌ Error: ${response.message}`);
        }
      });
    };

    joinBtn.onclick = () => {
      const roomId = roomIdJoinInput.value.trim();
      if (!roomId) return alert("Debes escribir un ID de sala.");

      const player = getPlayerData();
      socket.emit("joinRoom", {
        roomId,
        player
      });
      currentRoomId = roomId;
      showLeaveButton();
    };

    leaveBtn.onclick = () => {
      if (!currentRoomId) {
        alert("No estás en ninguna sala.");
        return;
      }
      const player = getPlayerData();
      socket.emit("leaveRoom", {
        roomId: currentRoomId,
        player
      });
      log(` Has salido de la sala ${currentRoomId}`);
      currentRoomId = null;
      hideLeaveButton();
    };

    socket.on("message", (msg) => {
      log(msg);
    });

    function log(msg) {
      const li = document.createElement("li");
      li.textContent = msg;
      messages.appendChild(li);
    }
  </script>
</body>
</html>
